(function($){var prefix='gamipress_mycred_importer_';var first_run=!0;var current_process=0;var process=['points',];function gamipress_mycred_migrate(show_info){if(show_info===undefined)
show_info=!0;if(process[current_process]===undefined){$('#'+prefix+'response').find('.spinner').remove();$('#'+prefix+'run').prop('disabled',!1);current_process=0;$('#'+prefix+'response').append('<br>Process finished succesfully!');return}else if(show_info){$('#'+prefix+'response').append('<br>Migrating '+process[current_process]+'...')}
var data={action:prefix+'import_'+process[current_process],first_run:(first_run?1:0),badges_achievement_type:$('#'+prefix+'badges_achievement_type').val(),badges_requirements_as_events:($('#'+prefix+'badges_requirements_as_events').prop('checked')?1:0),override_points:($('#'+prefix+'override_points').prop('checked')?1:0),};$('select[id^="'+prefix+'"][id$="_rank_type"]').each(function(){data[$(this).attr('id').replace(prefix,'')]=$(this).val()});$.ajax({url:ajaxurl,data:data,success:function(response){first_run=!1;var running_selector=$('#'+prefix+'response #running-'+process[current_process]);if(response.data.run_again!==undefined&&response.data.run_again){if(response.data.message!==undefined){if(!running_selector.length){$('#'+prefix+'response').append('<br><span id="running-'+process[current_process]+'"></span>');running_selector=$('#'+prefix+'response #running-'+process[current_process])}
running_selector.html(response.data.message)}
gamipress_mycred_migrate(!1)}else{if(running_selector.length){running_selector.prev('br').remove();running_selector.remove()}
$('#'+prefix+'response').append('<br>'+response.data);current_process++;setTimeout(gamipress_mycred_migrate,500)}},error:function(response){$('#'+prefix+'response').append('<br>'+'<span style="color: #a00;">'+response.data!==undefined?response.data:'Internal server error'+'</span>');return}})}
$('#'+prefix+'run').on('click',function(e){e.preventDefault();var $this=$(this);$this.prop('disabled',!0);if($('#'+prefix+'response').length)
$('#'+prefix+'response').remove();$this.parent().append('<div id="'+prefix+'response"><span class="spinner is-active" style="float: none;"></span></div>');if($('#'+prefix+'import_achievements').prop('checked'))
process.push('achievements');if($('#'+prefix+'import_ranks').prop('checked'))
process.push('ranks');if($('#'+prefix+'import_earnings').prop('checked'))
process.push('earnings');if($('#'+prefix+'import_logs').prop('checked'))
process.push('logs');first_run=!0;gamipress_mycred_migrate()});$('#'+prefix+'import_achievements').on('change',function(){var target=$('.cmb2-id-gamipress-mycred-importer-badges-achievement-type, .cmb2-id-gamipress-mycred-importer-badges-requirements-as-events');if($(this).prop('checked')){target.slideDown(250)}else{target.slideUp(250)}});if(!$('#'+prefix+'import_achievements').prop('checked')){$('.cmb2-id-gamipress-mycred-importer-badges-achievement-type, .cmb2-id-gamipress-mycred-importer-badges-requirements-as-events').hide()}
$('#'+prefix+'import_ranks').on('change',function(){var target=$(this).closest('.cmb2-metabox').find('.cmb-row[class*="-rank-type"]');if($(this).prop('checked')){target.slideDown(250)}else{target.slideUp(250)}});if(!$('#'+prefix+'import_ranks').prop('checked')){$('#'+prefix+'import_ranks').closest('.cmb2-metabox').find('.cmb-row[class*="-rank-type"]').hide()}})(jQuery)