!function(e){function t(a){if(n[a])return n[a].exports;var o=n[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=46)}([,,function(e,t,n){"use strict";function a(e,t){for(var n=e.replace(/^\?/,"").split("&"),a=0;a<n.length;a++){var o=n[a].split("=");if(o[0]==t)return o[1]}return!1}function o(e,t,n){var a=e.indexOf("#"),o=a===-1?"":e.substr(a);e=a===-1?e:e.substr(0,a);var i=new RegExp("([?&])"+t+"=.*?(&|$)","i"),d=e.indexOf("?")!==-1?"&":"?";if(e.match(i)&&""!==n)e=e.replace(i,"$1"+t+"="+n+"$2");else if(0==n.length){var r=e.replace(i,"");e=0==r.length?r:"?"+r}else e=e+d+t+"="+n;return e+o}function i(e){var t=e.match(/(\?.*)$/);return null==t?"":t[1]}Object.defineProperty(t,"__esModule",{value:!0}),t.getURLParam=a,t.updateURLParam=o,t.getQueryString=i},,,,,,,,,,,,,,,,function(e,t,n){"use strict";n(20),n(21),n(22),n(23),n(25),n(24),n(26),n(27),n(28),n(29)},,function(e,t,n){"use strict";!function(e){function t(){e(document).on("change",'[name="ld_gb_widget_gradebook"], [name="ld_gb_widget_group"]',n)}function n(){var t=e(this).closest(".postbox"),n=t.find(".ld-gb-widget-users"),a=n.find(".ld-gb-widget-user-template"),o=t.find('[name="ld_gb_widget_gradebook"]'),i=o.length&&o.find("option:selected").val()||0,d=t.find('[name="ld_gb_widget_group"]'),r=d.length&&d.find("option:selected").val()||0,s=e('<div class="ld-gb-widget-users-overlay"><span class="spinner"></span></div>');t.find(".ld-gb-widget-users-container").append(s),e.post(ajaxurl,{action:"ld_gb_dashboard_widget_get_data",group_id:r,gradebook_id:i,user_id:LD_GB_Admin.current_user_id},function(i){o.length&&t.find(".ld-gb-widget-gradebook-name").html(o.find("option:selected").html().trim()),n.find("tr:not(.ld-gb-widget-user-template)").remove(),i.data.users?e.each(i.data.users,function(e,t){var o=a.clone();o.find(".ld-gb-widget-user-name").html(t.name),o.find(".ld-gb-widget-user-grade").html(t.grade),o.removeClass("ld-gb-widget-user-template"),o.show(),n.append(o)}):n.append("<tr><td>"+LD_GB_Admin.l10n.no_users+"</td></tr>"),s.remove()})}e(t)}(jQuery)},function(e,t,n){"use strict";var a,o=n(2);!function(e,t){var n=a={init:function(){e("#ld-gb-gradebook-selector, #ld-gb-group-selector").change(n.gradebook_form_submit),e("#export-gradebook-components").on("submit",n.gradebook_export_components_submit),e("#export-gradebook-all-grades").on("submit",n.gradebook_export_all_grades_submit)},gradebook_form_submit:function(){e(this).closest("form").submit()},gradebook_export_components_submit:function(t){t.preventDefault();var a=e(this).find('input[type="submit"]');a.data("default_text",a.val()),a.val(a.data("submitting_text")).attr("disabled",!0);var o="",i=parseInt(e(this).find('input[type="submit"]').data("gradebook_id")),d=parseInt(e(this).find('input[type="submit"]').data("group_id")),r=parseInt(e(this).find('input[type="submit"]').data("per_page"));n.get_csv_component_data(i,d,o,1,r)},get_csv_component_data:function(a,i,d,r,s){var c=t.rest+"export-gradebook-component-data/"+a+"/"+i+"/",l=(0,o.getQueryString)(c);c=c.replace(l,""),l=(0,o.updateURLParam)(l,"paged",r),l=(0,o.updateURLParam)(l,"per_page",s),c+=l,e.ajax({url:c,method:"GET",cache:!1,headers:{"X-WP-Nonce":t.nonce},success:function(t){var o=t.csv_data;if(0!=d.length){var c=o.split("\n");c.splice(0,1),o=c.join("\n"),o="\n"+o}d+=o,parseInt(r)<t.total_pages?n.get_csv_component_data(a,i,d,parseInt(r)+1,s):(n.generate_download(d,"gradebook-"+a+"-"+i+"-components.csv"),e('#export-gradebook-components input[type="submit"]').val(e('#export-gradebook-components input[type="submit"]').data("default_text")).attr("disabled",!1))},error:function(t,n,a){var o=JSON.parse(t.responseText);"undefined"!=typeof o.message?console.error(o.message):"undefined"!=typeof o.exception&&console.error(o.exception),e('#export-gradebook-components input[type="submit"]').val(e('#export-gradebook-components input[type="submit"]').data("default_text")).attr("disabled",!1)}})},gradebook_export_all_grades_submit:function(t){t.preventDefault();var a=e(this).find('input[type="submit"]');a.data("default_text",a.val()),a.val(a.data("submitting_text")).attr("disabled",!0);var o="",i=parseInt(e(this).find('input[type="submit"]').data("gradebook_id")),d=parseInt(e(this).find('input[type="submit"]').data("group_id")),r=parseInt(e(this).find('input[type="submit"]').data("per_page"));n.get_csv_all_grades_data(i,d,o,1,r)},get_csv_all_grades_data:function(a,i,d,r,s){var c=t.rest+"export-gradebook-all-grades/"+a+"/"+i+"/",l=(0,o.getQueryString)(c);c=c.replace(l,""),l=(0,o.updateURLParam)(l,"paged",r),l=(0,o.updateURLParam)(l,"per_page",s),c+=l,e.ajax({url:c,method:"GET",cache:!1,headers:{"X-WP-Nonce":t.nonce},success:function(t){var o=t.csv_data;if(o){if(0!=d.length){var c=o.split("\n");c.splice(0,1),o=c.join("\n"),o="\n"+o}d+=o}parseInt(r)<t.total_pages?n.get_csv_all_grades_data(a,i,d,parseInt(r)+1,s):(n.generate_download(d,"gradebook-"+a+"-"+i+"-all-grades.csv"),e('#export-gradebook-all-grades input[type="submit"]').val(e('#export-gradebook-all-grades input[type="submit"]').data("default_text")).attr("disabled",!1))},error:function(t,n,a){var o=JSON.parse(t.responseText);"undefined"!=typeof o.message?console.error(o.message):"undefined"!=typeof o.exception&&console.error(o.exception),e('#export-gradebook-all-grades input[type="submit"]').val(e('#export-gradebook-all-grades input[type="submit"]').data("default_text")).attr("disabled",!1)}})},generate_download:function(e,t,a){"undefined"==typeof t&&(t="download.txt"),"undefined"==typeof a&&(a="attachment/text");var o=document.createElement("a");o.href="data:"+a+","+n.rfc3986EncodeURIComponent(e),o.target="_blank",o.download=t,o.click(),o.remove()},rfc3986EncodeURIComponent:function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16)}).replace(/\u00C0-\u024F\u1E00-\u1EFF/,function(e){return"%"+e.charCodeAt(0).toString(8)})}};e(n.init)}(jQuery,LD_GB_Admin.l10n)},function(e,t,n){"use strict";!function(e,t){var n={isWeighted:!1,init:function(){n.$components=e('[data-fieldhelpers-field-repeater="ld_gb_components"]'),n.$components.length&&(n.initGradebookWeightingInterface(),n.initGradebookComponents(),n.initUserSelect())},initGradebookWeightingInterface:function(){n.$interface=e("#ld-gb-gradebook-weighting"),n.$interface.length&&(n.weightingUpdateComponentList(),e('[data-fieldhelpers-name="ld_gb_gradebook_weighting_enable"] [data-fieldhelpers-field-toggle]').change(n.toggleInterfaceVisibility),e(document).on("keyup",'[name^="ld_gb_components"][name$="[name]"]',n.weightingUpdateComponentList),n.$components.on("repeater-add-item",n.weightingUpdateComponentList),n.$components.on("repeater-delete-item",n.weightingUpdateComponentList),n.$components.find(".fieldhelpers-field-repeater-list").on("list-update",n.weightingUpdateComponentList),e("form#post").submit(n.validateComponentWeights))},toggleInterfaceVisibility:function(e,t){"1"===t?(n.isWeighted=!0,n.$interface.show()):(n.isWeighted=!1,n.$interface.hide(),n.setInterfaceError(100))},validateComponentWeights:function(t){if(n.isWeighted){var a=0;n.$interface.find(".ld-gb-gradebook-weighting-component").each(function(){var t=parseInt(e(this).find('[name^="ld_gb_components"][name$="[weight]"]').val());a=t+a}),100!==a&&t.preventDefault(),n.setInterfaceError(a)}},setInterfaceError:function(e){var t=n.$interface.closest(".postbox"),a=t.find(".ld-gb-component-weighting-error-message");100!==e?(t.addClass("ld-gb-component-weighting-error"),a.show().find(".current-weight").html(e)):(t.removeClass("ld-gb-component-weighting-error"),a.hide())},weightingUpdateComponentList:function(){var t=n.weightingGetComponents(),a={};t.map(function(e,t){var o=n.$interface.find('.ld-gb-gradebook-weighting-component[data-id="'+e.id+'"]');o.length&&(a[e.id]=o.find('input[name$="[weight]"]').val())}),n.$interface.find("tbody").html(""),t.map(function(t,o){var i=a[t.id]||0,d=e('<tr class="ld-gb-gradebook-weighting-component" data-id="'+t.id+'"><td class="ld-gb-gradebook-weighting-component-name">'+t.name+'</td><td class="ld-gb-gradebook-weighting-component-weight"><input type="number" min="0" max="100" value="'+i+'" name="ld_gb_components['+o+'][weight]" /></td></tr>');d.show(),n.$interface.find("tbody").append(d)})},weightingGetComponents:function(){var a=n.$components.find("[data-repeater-item]"),o=[];return a.each(function(){var n=e(this).find('input[name$="[name]"]').val()||t.component_no_name,a={name:n,id:e(this).find('input[name$="[id]"]').val()};o.push(a)}),o},initGradebookComponents:function(){n.$components.find("[data-fieldhelpers-field-toggle]").on("change",n.toggleGradebookComponentsSelect),n.$components.on("repeater-add-item",function(e,t){n.componentLoading(!0,t),t.find("[data-fieldhelpers-field-toggle]").on("change",n.toggleGradebookComponentsSelect),n.toggleLessonsTopics(n.$course.val()),n.setComponentsError(!1),n.setComponentID(t)}),n.$course=e('select[name="ld_gb_course"]'),n.$course.length&&(n.$course.change(function(){n.componentsLoading(!0),n.setCourseOptions(e(this).val()),n.toggleLessonsTopics(e(this).val())}),n.$course.trigger("change")),e("form#post").submit(n.validateComponents)},componentLoading:function(t,n){t?n.append(e('<div class="ld-gb-loading-overlay"><span class="spinner is-active"></span></div>')):n.find(".ld-gb-loading-overlay").remove()},validateComponents:function(e){n.$components.find("[data-repeater-item]").length?n.setComponentsError(!1):(e.preventDefault(),n.setComponentsError(!0))},setComponentsError:function(e){var t=n.$components.closest(".postbox"),a=t.find(".ld-gb-component-error-message");e?(t.addClass("ld-gb-component-error"),a.show()):(t.removeClass("ld-gb-component-error"),a.hide())},setComponentID:function(t){e.ajax({method:"POST",url:ajaxurl,data:{action:"ld_gb_get_new_component_id",gradebook_id:LD_GB_Admin.gradebook_id}}).done(function(e){e.success&&(t.find('[data-fieldhelpers-name="id"] input[type="hidden"]').val(e.id),n.componentLoading(!1,t))})},componentsLoading:function(e){e?n.$components.append('<div class="ld-gb-loading-overlay"><span class="spinner is-active"></span></div>'):n.$components.find(".ld-gb-loading-overlay").remove()},setCourseOptions:function(t){e.ajax({method:"POST",url:ajaxurl,data:{action:"ld_gb_get_component_options",course:t,postID:e("#post_ID").val(),postStatus:e("#original_post_status").val()}}).done(function(t){e("select.ld-gb-component-items-select").each(function(){var n=e(this),a=[],o=e(this).attr("data-type");n.find("option:selected").each(function(){a.push(parseInt(e(this).val()))}),n.html(""),t.data[o].map(function(t){var o=a.indexOf(t.value)!==-1;n.append(e('<option value="'+t.value+'" '+(o&&"selected")+">"+t.text+"</option>"))})}),n.componentsLoading(!1)})},toggleLessonsTopics:function(t){var n=e('[data-fieldhelpers-name="lessons_section_divider"],[data-fieldhelpers-name="lessons"],[data-fieldhelpers-name="lessons_all"],[data-fieldhelpers-name="lessons_clearfix"],[data-fieldhelpers-name="topics_section_divider"],[data-fieldhelpers-name="topics"],[data-fieldhelpers-name="topics_all"],[data-fieldhelpers-name="topics_clearfix"]');t?n.show():n.hide()},toggleGradebookComponentsSelect:function(t,n){var a=(e(this).closest(".fieldhelpers-field-toggle").attr("data-fieldhelpers-name"),e(this).find(".fieldhelpers-field-input").attr("data-disable-group")),o=e(this).closest(".fieldhelpers-field-repeater-content").find('[data-disable-from-all="'+a+'"]');"1"===n?o.prop("disabled",!0):o.prop("disabled",!1)},initUserSelect:function(){if(n.$userSelect=e("#user_view_grades"),n.$userSelect.length){var a=n.$userSelect.closest(".fieldhelpers-field-select").next("[data-open-user-grades]"),o=a.attr("href");n.$userSelect.rbmfhselect2({containerCssClass:"fieldhelpers-select2",dropdownCssClass:"fieldhelpers-select2",placeholder:t.select_a_user,minimumInputLength:3,ajax:{delay:500,url:t.wp_rest+"users/",data:function(e){var t={search:e.term,per_page:10,page:e.page||1,has_published_posts:!1};return t},processResults:function(e){for(var t=[],n=0;n<e.results.length;n++)t.push({id:e.results[n].id,text:e.results[n].name});return{results:t,pagination:e.pagination}},transport:function(t,n,a){var o=function(e,n,a){var o=parseInt(a.getResponseHeader("X-WP-TotalPages"))||0;return{results:e,pagination:{more:t.data.page<o}}},i=e.ajax(t);i.then(o).then(n),i.fail(a)}}}),n.$userSelect.change(function(){a.removeClass("disabled"),a.attr("href",o+"&user="+e(this).val())}),a.click(function(t){e(this).hasClass("disabled")&&t.preventDefault()})}}};e(n.init)}(jQuery,LD_GB_Admin.l10n)},function(e,t,n){"use strict";!function(e,t){var n={init:function(){n.notices(),n.shift_key_utility()},notices:function(){var t=e(".ld-gb-notice.is-dismissible");t.each(function(){e(this).hasClass("not-dismissable")?e(this).removeClass("is-dismissible"):e(this).find(".notice-dismiss").click(n.dismiss_notice)})},dismiss_notice:function(){var t=e(this).closest(".ld-gb-notice"),n=t.attr("id");e.post(ajaxurl,{action:"ld_gb_dismiss_notice",id:n})},shift_key_utility:function(){window.ld_gb_shift_key_down=!1,e(document).on("keydown",function(e){16===e.which&&(window.ld_gb_shift_key_down=!0)}),e(document).on("keyup",function(e){16===e.which&&(window.ld_gb_shift_key_down=!1)})}};e(n.init)}(jQuery,LD_GB_Admin.l10n)},function(e,t,n){"use strict";!function(e,t){function n(){e("body").hasClass("ld-gb-quickstart")&&(e("body").is(".post-php, .post-type-gradebook")&&a(),e("body").hasClass("admin_page_learndash-gradebook-user-grades")&&o())}function a(){e("form#post").submit(function(e){e.preventDefault()}),e('[data-fieldhelpers-name="ld_gb_components"]').find("[data-repeater-delete], [data-repeater-create]").prop("disabled",!0)}function o(){e(".ld-gb-return-button").remove(),e("[data-edit-grade], [data-ld-gb-component-grade], [data-add-manual-grade]").click(function(e){return e.preventDefault(),alert(t.disabled_for_quickstart),!1})}e(n)}(jQuery,LD_GB_Admin.l10n)},function(e,t,n){"use strict";!function(e,t){function n(){"undefined"!=typeof LD_GB_Quickstart&&LD_GB_Quickstart&&(e.each(LD_GB_Quickstart,function(n,a){e.extend(a.options,{pointerClass:"wp-pointer ld-gb-pointer",pointerWidth:450,close:function(){e.post(ajaxurl,{action:"ld_gb_disable_quickstart"},function(e){if("undefined"!=typeof e.success&&e.success){var n,a=window.location.href,o=["ld_gb_quickstart","gradebook","post"];for(var i in o){n=o[i];var d=a.split("?");if(d.length>=2){for(var r=encodeURIComponent(n)+"=",s=d[1].split(/[&;]/g),c=s.length;c-- >0;)s[c].lastIndexOf(r,0)!==-1&&s.splice(c,1);a=d[0]+(s.length>0?"?"+s.join("&"):"")}}window.location=a}else"undefined"!=typeof e.data&&"undefined"!=typeof e.error?alert(e.error):alert(t.disable_quickstart_error_generic)})},buttons:function o(n,r){var s=wpPointerL10n?wpPointerL10n.dismiss:"Dismiss",c=a.options.quickstart_text?a.options.quickstart_text:t.quickstart_text,l=!!a.options.quickstart_link&&a.options.quickstart_link,p=a.options.quickstart_back_text?a.options.quickstart_back_text:t.quickstart_back_text,g=!!a.options.quickstart_back_link&&a.options.quickstart_back_link,u='<a class="close" href="#">'+s+"</a>",m='<a class="quickstart-back" href="'+g+'">'+p+"</a>",f='<a class="button quickstart" href="'+l+'">'+c+"</a>",o=e('<div class="ld-gb-quickstart-buttons">'+u+f+m+"</div>");return l===!1&&o.find(".quickstart").remove(),g===!1&&o.find(".quickstart-back").remove(),o.on("click",".quickstart",i),o.on("click",".quickstart-back",d),o.on("click",".close",function(e){e.preventDefault(),r.element.pointer("close")})}});s.push(a)}),s.length&&e(window).on("load",function(){r=0,a(s[0])}))}function a(t){var n,a,o=e(t.target);e(t.target).pointer(t.options).pointer("open"),n=o.pointer("widget"),o.pointer("reposition"),a=n.hasClass("wp-pointer-top")?n.offset().top-n.height():n.offset().top,o.closest("#adminmenu").length?(n.css("position","fixed"),n.position().top+n.height()>e(window).height()&&n.css("top",e(window).height()-n.height()),n.position().top<0&&n.css("top",0)):e("body, html").animate({scrollTop:a-e("#wpadminbar").height()},500)}function o(t){var n=e(t.target),a=n.pointer("widget");a.is(":visible")&&a.fadeOut(300)}function i(e){s.length<=1||(r++,"undefined"!=typeof s[r]&&(o(s[r-1]),a(s[r]),e.preventDefault()))}function d(e){s.length<=1||(r--,"undefined"!=typeof s[r]&&(o(s[r+1]),a(s[r]),e.preventDefault()))}var r,s=[];e(n)}(jQuery,LD_GB_Admin.l10n)},function(e,t,n){"use strict";var a;!function(e,t){t={$elements:{},init:function(){t.get_elements(),t.$elements.repeaters.length&&(t.setup_repeaters_data(),t.init_repeaters(),e(document).on("click","a[data-repeater-delete], a[data-repeater-create]",function(e){e.preventDefault()}))},get_elements:function(){t.$elements.repeaters=e("[data-ld-gb-repeater]")},setup_repeaters_data:function(){},init_repeaters:function(){t.$elements.repeaters.each(t.init_repeater)},init_repeater:function(){var t=!!e(this).attr("data-first-item-undeletable"),n=!!e(this).attr("data-init-empty"),a=e(this),o=e(this).attr("data-default-values")||{};e(this).repeater({hide:function(t){e(this).hasClass("locked")||confirm(LD_GB_Admin.l10n.repeater_confirm_delete)&&(a.trigger("repeater-remove",[e(this)]),t(),a.trigger("repeater-removed"))},show:function(){a.trigger("repeater-add",[e(this)]),e(this).show(),a.trigger("repeater-added",[e(this)])},isFirstItemUndeletable:t,defaultValues:o,initEmpty:n}),e(this).find("[data-repeater-item-dummy]").remove(),e(this).trigger("repeater-init")}},e(t.init)}(jQuery,a)},function(e,t,n){"use strict";!function(e){function t(){i=e('input[name="ld_gb_gradebook_roles[]"]'),d=e('input[name="ld_gb_edit_gradebook_roles[]"]'),i.length&&d.length&&(d.on("change",n),i.on("change",a))}function n(t){var n=e(this).val(),a=o(i);e(this).prop("checked")&&a.indexOf(n)===-1&&i.filter(function(t){return e(this).val()==n}).attr("checked",!0).trigger("change")}function a(t){var n=e(this).val(),a=o(d);e(this).prop("checked")||a.indexOf(n)>-1&&d.filter(function(t){return e(this).val()==n}).attr("checked",!1).trigger("change")}function o(t){var n=[];return t.each(function(t,a){e(a).prop("checked")&&n.push(e(a).val())}),n}var i,d;e(t)}(jQuery)},function(e,t,n){"use strict";!function(e,t){function n(){g=e("#ld-gb-edit-components"),g.length&&(l=e("#ld-gb-edit-components-form"),p=g.find(".notice.error"),g.on("repeater-added",a),g.on("repeater-removed",o),g.on("click",".locked [data-repeater-delete]",i),g.on("click",".notice-dismiss",r),l.submit(c),l.submit(s))}function a(e,t){g.removeClass("no-components"),t.find('[name$="term_id]"]').val(""),t.find(".ld-gb-edit-components-info").html(""),t.removeClass("locked"),t.find('[name$="[name]"]').focus()}function o(e){g.find("[data-repeater-item]").length||g.addClass("no-components")}function i(e){e.preventDefault(),d(t.cannot_delete_component)}function d(e){window.clearTimeout(u),p.find("p").html(e),p.stop().slideDown(300)}function r(){return p.stop().slideUp(300,function(){e(this).find("p").html("")}),!1}function s(n){var a=g.find('[name$="weight]"]:visible,[name$="name]"]:visible');return a.length?void a.each(function(){if(!e(this).val())return n.preventDefault(),d(t.required),!1}):void r()}function c(n){var a,o,i=g.find('[name*="weight"]:visible'),s=0,c=!1;if(i.length){for(a=0;a<i.length;a++){if(o=e(i.get(a)),!o.val())return;if(s+=parseInt(o.val()),s>100){n.preventDefault(),c=t.weights_too_high.replace("{percent}",s);break}if(a+1===i.length&&s<100){n.preventDefault(),c=t.weights_too_low.replace("{percent}",s);break}}c?d(c):r()}}var l,p,g,u;e(n)}(jQuery,LD_GB_Admin.l10n)},function(e,t,n){"use strict";!function(e,t){var n={$elements:{},init:function(){n.get_elements(),n.$elements&&n.setup_handlers()},get_elements:function(){n.$elements.gradebook=e("#ld-gb-gradebook")},setup_handlers:function(){n.$elements.gradebook.on("click","[data-ld-gb-component-edit]",n.edit_component_grade),n.$elements.gradebook.on("click","[data-ld-gb-component-cancel]",n.cancel_component_grade),n.$elements.gradebook.on("click","[data-ld-gb-component-submit]",n.submit_component_grade),n.$elements.gradebook.on("click","[data-ld-gb-component-delete]",n.delete_component_grade),n.$elements.gradebook.on("keypress",".ld-gb-gradebook-component-edit input",n.submit_component_grade),n.$elements.gradebook.on("click","[data-edit-grade]",n.edit_grade),n.$elements.gradebook.on("click","[data-cancel-edit-grade]",n.cancel_edit_grade),n.$elements.gradebook.on("click","[data-submit-edit-grade]",n.submit_edit_grade),n.$elements.gradebook.on("click","[data-remove-manual-grade]",n.remove_manual_grade),n.$elements.gradebook.on("click","[data-add-manual-grade]",n.add_manual_grade),n.$elements.gradebook.on("click","[data-cancel-add-manual-grade]",n.cancel_edit_manual_grade),n.$elements.gradebook.on("keypress",".ld-gb-gradebook-component-grade-editform input,.ld-gb-gradebook-component-grade-editform select,.ld-gb-gradebook-component-grade-editform textarea",n.submit_edit_grade)},edit_component_grade:function(t){t.preventDefault();var n=e(this).closest(".ld-gb-gradebook-component-overall-grade"),a=n.attr("data-ld-gb-component-grade");n.find('input[type="text"][name="ld-gb-component-override"]').val(a),n.addClass("editing")},cancel_component_grade:function(t){t.preventDefault(),n.close_edit_component_grade(e(this).closest(".ld-gb-gradebook-component-overall-grade"))},delete_component_grade:function(a){a.preventDefault();var o=e(this).closest(".ld-gb-gradebook-component-overall-grade"),i=o.closest(".ld-gb-gradebook-component"),d=o.attr("data-user-id"),r=o.attr("data-component-id");o.find(".ld-gb-gradebook-component-edit").append('<div class="ld-gb-gradebook-component-overall-grade-cover"><span class="spinner"></span></div>'),o.find("input, button, textarea, select").prop("disabled",!0),e.post(ajaxurl,{action:"ld_gb_edit_component_grade",data:{action:"delete",user_id:d,component_id:r,gradebook:LD_GB_Admin.gradebook}},function(e){"undefined"!=typeof e.success&&(e.success&&(o.attr("data-ld-gb-component-grade",e.data.component_grade.grade),n.change_user_grade(e.data.user_grade),n.change_component_grade(i,e.data.component_grade),o.removeClass("overridden"),o.find("[data-ld-gb-component-edit]").html(t.component_grade_override),i.find(".ld-gb-gradebook-component-overridden-notice").hide()),n.close_edit_component_grade(o))})},submit_component_grade:function(a){if("undefined"==typeof a.which||13==a.which||1==a.which){a.preventDefault();var o=e(this).closest(".ld-gb-gradebook-component-overall-grade"),i=o.closest(".ld-gb-gradebook-component"),d=o.attr("data-user-id"),r=o.attr("data-component-id"),s=o.find('input[type="text"][name="ld-gb-component-override"]').val();o.find(".ld-gb-gradebook-component-edit").append('<div class="ld-gb-gradebook-component-overall-grade-cover"><span class="spinner"></span></div>'),o.find("input, button, textarea, select").prop("disabled",!0),e.post(ajaxurl,{action:"ld_gb_edit_component_grade",data:{action:"save",new_grade:s,user_id:d,component_id:r,gradebook:LD_GB_Admin.gradebook}},function(e){"undefined"!=typeof e.success&&(e.success&&(o.attr("data-ld-gb-component-grade",e.data.component_grade.grade),n.change_user_grade(e.data.user_grade),n.change_component_grade(i,e.data.component_grade),o.addClass("overridden"),o.find("[data-ld-gb-component-edit]").html(t.component_grade_modify),i.find(".ld-gb-gradebook-component-overridden-notice").show()),n.close_edit_component_grade(o))})}},close_edit_component_grade:function(e){e.find(".ld-gb-gradebook-component-overall-grade-cover").remove(),e.find("input, button, textarea, select").prop("disabled",!1),e.removeClass("editing")},edit_grade:function(t){t.preventDefault();var n=e(this).closest("tr"),a=n.next("tr.ld-gb-gradebook-component-grade-editform");n.length&&a.length&&(n.addClass("editing"),a.addClass("editing"))},cancel_edit_grade:function(t){t.preventDefault();var n=e(this).closest(".ld-gb-gradebook-component"),a=e(this).closest("tr"),o=a.prev("tr.ld-gb-gradebook-component-grade-display"),i=n.find("[data-add-manual-grade]");"undefined"!=o.attr("data-template")&&o.length&&a.length&&(o.removeClass("editing"),a.removeClass("editing"),i.show())},submit_edit_grade:function(a){if("undefined"==typeof a.which||13==a.which||1==a.which){a.preventDefault();var o,i=e(this).closest(".ld-gb-gradebook-component"),d=e(this).closest("tr.ld-gb-gradebook-component-grade-editform"),r=d.prev("tr.ld-gb-gradebook-component-grade-display"),s=d.find("input, select, textarea"),c=d.find(".ld-gb-gradebook-component-grade-message"),l=i.find("[data-no-grades]"),p={};if(s.each(function(){p[e(this).attr("name").replace("grade-","")]=e(this).val()}),"undefined"!=typeof p.type){if(o=p.type,"manual"==o){if("undefined"==typeof p.name||"undefined"==typeof p.score||!p.score)return void n.show_message(c,t.manual_grade_add_error,"error");n.hide_message(c,"error")}e.post(ajaxurl,{action:"ld_gb_edit_grade",data:p},function(e){return"0"==e?void n.show_message(c,t.could_not_edit_grade,"error"):e.success?(n.show_message(c,e.data.success,"success"),"manual"==o&&(r.find(".ld-gb-gradebook-component-grade-name-content").html(e.data.name),d.find('[name="grade-previous_name"]').val(e.data.name),d.find('[name="grade-score"]').val(e.data.score),d.find('[name="grade-new"]').val("1")&&(d.find('[name="grade-new"]').val("0"),d.find("[data-submit-edit-grade]").html(t.change),d.find("[data-cancel-add-manual-grade]").removeAttr("data-cancel-add-manual-grade").attr("data-cancel-edit-grade","1").html(t.close))),"undefined"!=typeof e.data.score_display&&r.find(".ld-gb-gradebook-component-grade-score-content").html(e.data.score_display),"undefined"!=typeof e.data.user_grade&&n.change_user_grade(e.data.user_grade),"undefined"!=typeof e.data.component_grade&&n.change_component_grade(i,e.data.component_grade),i.find("tbody tr:not([data-template])").length?l.hide():l.show(),void 0):void n.show_message(c,e.data.error,"error")})}}},add_manual_grade:function(t){t.preventDefault();var n=e(this).closest(".ld-gb-gradebook-component"),a=n.find("tr.ld-gb-gradebook-component-grade-display[data-template]"),o=n.find("tr.ld-gb-gradebook-component-grade-editform[data-template]"),i=a.clone(),d=o.clone();d.find(':input:not([type="hidden"])').each(function(t,n){var a=e(n).data("default");"undefined"==typeof a&&(a=""),e(n).val(a)}),d.insertBefore(a).addClass("editing").removeAttr("data-template"),i.insertBefore(d).addClass("editing").removeAttr("data-template"),e(this).hide()},cancel_edit_manual_grade:function(t){t.preventDefault();var n=e(this).closest(".ld-gb-gradebook-component"),a=e(this).closest("tr"),o=a.prev("tr.ld-gb-gradebook-component-grade-display"),i=n.find("[data-add-manual-grade]");o.length&&a.length&&(o.remove(),a.remove(),i.show())},remove_manual_grade:function(a){if(a.preventDefault(),confirm(t.manual_grade_confirm_delete)){var o=e(this).closest(".ld-gb-gradebook-component"),i=e(this).closest("tr.ld-gb-gradebook-component-grade-display"),d=i.next("tr.ld-gb-gradebook-component-grade-editform"),r=d.find("input, select, textarea"),s=o.find("[data-no-grades]"),c={};r.each(function(){c[e(this).attr("name").replace("grade-","")]=e(this).val()}),c["delete"]="1",e.post(ajaxurl,{action:"ld_gb_edit_grade",data:c},function(e){"0"!=e&&e.success&&(i.addClass("deleted").fadeOut(500,function(){i.remove(),d.remove(),o.find("tbody tr:not([data-template]):not([data-no-grades])").length?s.hide():s.show()}),"undefined"!=typeof e.data.user_grade&&n.change_user_grade(e.data.user_grade),"undefined"!=typeof e.data.component_grade&&n.change_component_grade(o,e.data.component_grade))})}},get_manual_edit_elements:function(e){var t={};return t.name=e.find(".ld-gb-gradebook-component-grade-name"),t.name_content=t.name.find(".ld-gb-gradebook-component-grade-name-content"),t.score=e.find(".ld-gb-gradebook-component-grade-score"),t.score_content=t.score.find(".ld-gb-gradebook-component-grade-score-content"),t.input_name=t.name.find('input[name="ld_gb_gradebook_component_grade_name"]'),t.input_score=t.score.find('input[name="ld_gb_gradebook_component_grade_score"]'),t},change_user_grade:function(e){n.$elements.gradebook.find("span.user-grade").html(e.score).css("background",e.color)},change_component_grade:function(e,t){e.find(".ld-gb-gradebook-component-overall-grade .ld-gb-grade").html(t.score).css("background",t.color)},show_message:function(e,t,n){e.find(".notice-"+n).stop().slideDown(150).find("p").html(t),e.find(".notice-"+n).delay(5e3).slideUp(150)},hide_message:function(e,t){e.find(".notice-"+t).stop().slideUp(150)},row_set_processing:function(e){e.addClass("processing"),e.find(".ld-gb-gradebook-component-grade-name").append('<span class="spinner"></span>')},row_remove_processing:function(e){e.removeClass("processing"),e.find(".spinner").remove()},stop_propagation:function(e){e.stopPropagation()}};e(n.init)}(jQuery,LD_GB_Admin.l10n)},,,,,,,,,,,,,,,,,function(e,t,n){e.exports=n(18)}]);